<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Valoraci√≥n de riesgo feminicida</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="app-header">
    <h1>Sistema de valoraci√≥n de riesgo feminicida</h1>
    <p class="subtitle">
      Registro y an√°lisis inicial de casos a partir de la descripci√≥n de los hechos.
    </p>
  </header>

  <main class="layout">
    <!-- FORMULARIO -->
    <section class="card">
      <h2>Registro del caso</h2>

      <form id="case-form" autocomplete="off">
        <div class="grid-2">
          <div class="form-group">
            <label for="victim_name">Nombre de la v√≠ctima (opcional)</label>
            <input type="text" id="victim_name" name="victim_name" />
          </div>

          <div class="form-group">
            <label for="victim_age">Edad (opcional)</label>
            <input type="number" id="victim_age" name="victim_age" min="0" />
          </div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label for="municipality">Municipio (opcional)</label>
            <input type="text" id="municipality" name="municipality" />
          </div>

          <div class="form-group">
            <label for="aggressor_relation">Relaci√≥n con el agresor (opcional)</label>
            <select id="aggressor_relation" name="aggressor_relation">
              <option value="">Selecciona una opci√≥n</option>
              <option value="pareja">Pareja</option>
              <option value="ex_pareja">Ex pareja</option>
              <option value="familiar">Familiar</option>
              <option value="conocido">Conocido</option>
              <option value="desconocido">Desconocido</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="description">
            Descripci√≥n de los hechos <span class="required">*</span>
          </label>
          <textarea
            id="description"
            name="description"
            rows="7"
            placeholder="Redacta de forma detallada lo ocurrido, incluyendo amenazas, uso de armas, antecedentes de violencia, intentos de asfixia, desaparici√≥n, etc."
            required
          ></textarea>
        </div>

        <div class="form-footer">
          <p class="note">
            Esta herramienta es un apoyo t√©cnico para valorar el riesgo. No sustituye la valoraci√≥n profesional integral.
          </p>
          <button type="submit" class="btn-primary">Evaluar riesgo</button>
        </div>
      </form>

      <!-- üîÑ Cargando evaluaci√≥n individual (arranca oculto) -->
      <div id="single-loading" class="loading-row" hidden>
        <div class="spinner"></div>
        <span>Evaluando riesgo, por favor espera...</span>
      </div>

      <p id="form-error" class="error-message" hidden></p>
    </section>

    <!-- RESULTADO -->
    <section class="card result-card">
      <h2>Resultado de la valoraci√≥n</h2>

      <div id="result-empty">
        <p class="muted">
          A√∫n no se ha evaluado ning√∫n caso. Captura la informaci√≥n y haz clic en
          <strong>‚ÄúEvaluar riesgo‚Äù</strong>.
        </p>
      </div>

      <div id="result-content" class="hidden">
        <div class="risk-summary">
          <span class="label">Nivel de riesgo:</span>
          <span id="risk-level" class="badge badge-moderado">MODERADO</span>
        </div>

        <div class="risk-score">
          <span class="label">Puntaje total:</span>
          <span id="risk-score" class="score-value">0</span>
        </div>

        <div class="risk-factors">
          <span class="label">Factores identificados:</span>
          <ul id="risk-factors-list"></ul>
        </div>

        <div class="recommendations">
          <h3>Recomendaciones iniciales</h3>
          <ul id="recommendations-list"></ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Secci√≥n de evaluaci√≥n masiva desde CSV -->
  <section class="card card-wide" id="bulk-section">
    <h2>Evaluaci√≥n masiva a partir de archivo CSV</h2>
    <p class="muted">
      Carga un archivo de casos en formato CSV (por ejemplo, el exportado desde el sistema EUV).
      El archivo se procesa √∫nicamente en este equipo, sin enviarse a ning√∫n servidor.
    </p>

    <div class="bulk-controls">
      <input type="file" id="csv-file" accept=".csv" />
      <button type="button" class="btn-secondary" id="process-csv">Procesar archivo</button>
      <span id="bulk-file-name" class="muted small"></span>
      <span id="bulk-status" class="muted small"></span>
    </div>

    <!-- üîÑ Cargando CSV (arranca oculto) -->
    <div id="bulk-loading" class="loading-row small" hidden>
      <div class="spinner"></div>
      <span>Procesando archivo, por favor espera...</span>
    </div>

    <p id="bulk-error" class="error-message" hidden></p>

    <!-- ‚úÖ CHIPS COMO BOTONES FILTRO -->
    <div id="bulk-summary" class="bulk-summary hidden">
      <button class="chip chip-all is-active" type="button" data-filter="all">
        Total: <strong id="bulk-total">0</strong>
      </button>

      <button class="chip chip-moderado" type="button" data-filter="moderado">
        Riesgo moderado: <strong id="bulk-moderado">0</strong>
      </button>

      <button class="chip chip-grave" type="button" data-filter="grave">
        Riesgo grave: <strong id="bulk-grave">0</strong>
      </button>

      <button class="chip chip-extremo" type="button" data-filter="extremo">
        Riesgo extremo: <strong id="bulk-extremo">0</strong>
      </button>
    </div>

    <div class="bulk-table-wrapper hidden" id="bulk-table-wrapper">
      <table class="bulk-table">
        <thead>
          <tr>
            <th>ID caso</th>
            <th>Municipio del hecho</th>
            <th>Edad v√≠ctima</th>
            <th>Nivel de riesgo</th>
            <th>Puntaje</th>
          </tr>
        </thead>
        <tbody id="bulk-tbody"></tbody>
      </table>
    </div>
  </section>

  <footer class="app-footer">
    <small>
      Prototipo de sistema para valoraci√≥n de riesgo feminicida. Uso interno para an√°lisis y validaci√≥n metodol√≥gica.
    </small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
